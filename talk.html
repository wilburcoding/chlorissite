<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>All Fresh Floral</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"
    integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=chevron_right,network_intelligence" />
</head>

<body>
  <div class="top-bar">
    Same-Day Design and Hand-Delivery!* &nbsp; | &nbsp; Proudly Serving Roslyn Heights, NY since 2013
  </div>
  <header>
    <img src="https://res.cloudinary.com/ufn/image/upload/c_pad,f_auto,q_auto,fl_progressive/1543502147523_1">
    <p>FREE DELIVERY for local online orders*</p>
  </header>
  <nav>
    <span>Deal of the Day</span>
    <span>Occasions</span>
    <span>Birthday</span>
    <span>Sympathy and Funeral</span>
    <span>Flowers, Plants & Gifts</span>
    <span>Our Shop</span>
  </nav>

  <div class="chat" style="min-height:45vh;display: flex;flex-direction: row;justify-content: space-evenly;">
    <div
      style="height:500px;border-radius:0px 0px 15px 15px;padding:0;border:solid 1px gray;max-width:500px;background-color: #fffcf1;margin:10px;display:flex;flex-direction: column;align-items: center;justify-content: center;">
      <div style="height:450px;width:495px;margin:0;box-sizing: border-box;padding:5px;overflow-y: scroll;" id="chat">

      </div>
      <div style="display:flex;flex-direction: row;margin:0;padding:0;height:50px;">
        <textarea id="prompt"
          style="height:50px;width:450px;margin:0;resize:none;border-radius:0px 0px 0px 15px;padding:5px;font-size:20px;outline:none;box-sizing: border-box;"></textarea>
        <button id="send"
          style="width:50px;height:50px;margin:0;background-color: #363c5a;color:#f8f0df;border-radius:0px 0px 15px 0px;margin:0;display:flex;align-items: center;justify-content: center;"><span
            class="material-symbols-outlined">
            chevron_right
          </span></button>
      </div>
    </div>
  </div>
  <div class="guarantee"
    style="background-color: rgb(206, 206, 206);padding-top:30px;padding-bottom:30px;margin-bottom:0;">
    100% Satisfaction Guaranteed &nbsp; | &nbsp; We are a <strong>REAL</strong> local florist &nbsp; | &nbsp; 100%
    Florist-Designed and Hand-Delivered
  </div>

  <script>
      const UID = Math.random().toString(36).substr(2); 
    $("#send").click(function () {
      if ($("#prompt").val() == "") {
        return
      }
      $("#chat").append(`
        <div style="width:100%;margin-bottom:5px;padding:0;">
          <div style="background-color:white;margin-left:auto;margin-right:0px;width:fit-content;border-radius:10px 0px 10px 10px;padding:5px 10px">
            <p style="color:black;margin-top:2px;margin-bottom:2px">${$("#prompt").val()}</p>
          </div>  
        </div>
        `)
      fetch("http://localhost:3005/chat", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          "message": $("#prompt").val(),
          "time":Date.now(),
          "uid":UID

        })
      }).then(() => {
        $("#prompt").val("");
      })


    })
    let lastcheck = Date.now();
    
    setInterval(function () {
      fetch("http://localhost:3005/chat")
        .then(response => response.json())
        .then(json => {
          for (var item of json) {
            if (item.time > lastcheck && item.uid != UID) {
              $("#chat").append(`
                <div style="width:100%;margin-bottom:5px;padding:0;">
                  <div style="background-color:black;margin-left:0;margin-right:5px;width:fit-content;border-radius:0px 10px 10px 10px;padding:5px 10px">
                    <p style="color:white;margin-top:2px;margin-bottom:2px">${item.message}</p>
                  </div>  
                </div>
                `)
            }
          }
          lastcheck = Date.now();
        })
    }, 1000)

  </script>
</body>

</html>