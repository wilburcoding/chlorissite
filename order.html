<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>All Fresh Floral</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"
    integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=chevron_right,network_intelligence" />
</head>

<body>
  <div class="top-bar">
    Same-Day Design and Hand-Delivery!* &nbsp; | &nbsp; Proudly Serving Roslyn Heights, NY since 2013
  </div>
  <header>
    <img src="https://res.cloudinary.com/ufn/image/upload/c_pad,f_auto,q_auto,fl_progressive/1543502147523_1">
    <p>FREE DELIVERY for local online orders*</p>
  </header>
  <nav>
    <span>Deal of the Day</span>
    <span>Occasions</span>
    <span>Birthday</span>
    <span>Sympathy and Funeral</span>
    <span>Flowers, Plants & Gifts</span>
    <span>Our Shop</span>
  </nav>
  <div id="aichat"
    style="height:70px;border:solid 1px gray;box-shadow: 0px 0px 8px #888888;width:70px;border-radius:50%;background-color: #fff8e0;position:fixed;bottom:0;right:0;margin:10px;display:flex;align-items: center;justify-content: center;">
    <span class="material-symbols-outlined" style="font-size:50px;">
      network_intelligence
    </span>
  </div>
  <div id="aichatm"
    style="height:500px;border-radius:0px 0px 15px 15px;padding:0;opacity:0;border:solid 1px gray;max-width:300px;background-color: #fffcf1;position:fixed;bottom:85px;right:0;margin:10px;display:flex;flex-direction: column;align-items: center;justify-content: center;">
    <div style="height:450px;width:295px;margin:0;box-sizing: border-box;padding:5px;overflow-y: scroll;" id="chat">

    </div>
    <div style="display:flex;flex-direction: row;margin:0;padding:0;">
      <textarea id="prompt"
        style="height:50px;width:100%;margin:0;resize:none;border-radius:0px 0px 0px 15px;padding:5px;font-size:20px;outline:none;box-sizing: border-box;"></textarea>
      <button id="send"
        style="width:50px;height:50px;margin:0;background-color: #363c5a;color:#f8f0df;border-radius:0px 0px 15px 0px;display:flex;align-items: center;justify-content: center;"><span
          class="material-symbols-outlined">
          chevron_right
        </span></button>
    </div>
  </div>
  <div class="banner" style="min-height:45vh;display: flex;flex-direction: row;justify-content: space-evenly;">
    <div class="form">
      <h2>Place an Order</h2>
      <form id="orderform">
        <div class="form-group">
          <label for="name">Name</label>
          <input type="text" id="name" name="cname" required>
        </div>
        <div class="form-group">
          <label for="email">Email</label>
          <input type="email" id="email" name="cemail" required>
        </div>
        <div class="form-group">
          <label for="phone">Phone</label>
          <input type="tel" id="phone" name="cphone" required>
        </div>
        <div class="form-group">
          <label for="address">Address</label>
          <input type="text" id="address" name="caddress" required>
        </div>
        <div class="form-group">
          <label for="size">Order Size</label>
          <select id="size" name="size" required>
            <option value="small">Small</option>
            <option value="medium">Medium</option>
            <option value="large">Large</option>
          </select>
        </div>
        <div class="form-group">
          <label for="request">Special Request</label>
          <textarea id="request" name="desc" rows="4"
            placeholder="Ask for anything and we'll see what we can do!"></textarea>
        </div>

      <button type="submit" class="button">Submit Order</button>
      </form>
    </div>
  </div>
  <div class="guarantee"
    style="background-color: rgb(206, 206, 206);padding-top:30px;padding-bottom:30px;margin-bottom:0;">
    100% Satisfaction Guaranteed &nbsp; | &nbsp; We are a <strong>REAL</strong> local florist &nbsp; | &nbsp; 100%
    Florist-Designed and Hand-Delivered
  </div>

  <script>
    $("#send").click(function () {
      if ($("#prompt").val() == "") {
        return
      }
      $("#chat").append(`
            <div style="width:100%;margin-bottom:5px;padding:0;">
              <div style="background-color:white;margin-left:auto;margin-right:0px;width:fit-content;border-radius:10px 0px 10px 10px;padding:5px 10px">
                <p style="color:black;margin-top:2px;margin-bottom:2px">${$("#prompt").val()}</p>
              </div>  
            </div>
            `)
      fetch("http://localhost:3005/ask", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          "prompt": $("#prompt").val()
        })
      })
        .then(response => response.json())
        .then(json => {
          $("#prompt").val("");
          console.log(json)
          $("#chat").append(`
            <div style="width:100%;margin-bottom:5px;padding:0;">
              <div style="background-color:black;margin-left:0;margin-right:5px;width:fit-content;border-radius:0px 10px 10px 10px;padding:5px 10px">
                <p style="color:white;margin-top:2px;margin-bottom:2px>${json.response}</p>
              </div>  
            </div>
            `)
        })

    })
    $("#aichat").click(function () {
      //animate
      if ($("#aichatm").css("opacity") == 0) {
        $("#aichatm").animate({
          opacity: 1
        }, 200)
      } else {
        $("#aichatm").animate({
          opacity: 0
        }, 200)
      }
    })
    $("#order").click(function () {
      window.location.href = "order.html"
    })
    document.getElementById('orderform').addEventListener('submit', async function (event) {
      event.preventDefault();
      const formData = new FormData(this);
      let data = Object.fromEntries(formData);
      data["id"] = Math.random().toString(36).substring(2, 12);
      try {
        const response = await fetch('http://localhost:3005/orders', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        });

        if (!response.ok) throw new Error('Network response was not ok');

        alert('Thank you! Your order has been submitted.');
        this.reset();
      } catch (error) {
        alert('There was an error submitting your order. Please try again.');
        console.error('Order submission failed:', error);
      }
    });
  </script>
</body>

</html>